name: Test

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - "**"
  workflow_dispatch:

jobs:
  run-test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - run: |
          if git log -1 --pretty=%B | grep "^edr-[0-9]\+\.[0-9]\+\.[0-9]\+\s*"; then
            if [ "$GITHUB_REF" == "refs/heads/main" ]; then
              echo "Publish release"
            else
              echo "Release commit in non-main branch"
              exit 1
            fi
          elif git log -1 --pretty=%B | grep "^test-[0-9]\+\.[0-9]\+\.[0-9]\+-"; then
            echo "Publish pre-release"
          fi
